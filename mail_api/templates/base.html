<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content="{{ request.state.csrf_token | default('') }}" />
    <title>{% block page_title %}MAIL_API{% endblock %}</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <style>
      :root {
        --bg0: #070a12;
        --bg1: #0c1020;
        --panel: rgba(255, 255, 255, 0.06);
        --panel2: rgba(255, 255, 255, 0.08);
        --border: rgba(255, 255, 255, 0.12);
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.68);
        --shadow: 0 20px 60px rgba(0, 0, 0, 0.55);
        --shadow2: 0 12px 28px rgba(0, 0, 0, 0.45);
        --accent: #7c5cff;
        --accent2: #2fd0ff;
        --good: #2ee59d;
        --warn: #ffcc66;
        --bad: #ff4d6d;
      }

      html,
      body {
        height: 100%;
      }

      body {
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial,
          sans-serif;
        color: var(--text);
        background: radial-gradient(1200px 900px at 20% 10%, #1b2a6b 0%,
            rgba(27, 42, 107, 0) 55%),
          radial-gradient(1200px 900px at 80% 20%, #3a145f 0%,
            rgba(58, 20, 95, 0) 60%),
          linear-gradient(180deg, var(--bg0) 0%, var(--bg1) 100%);
        overflow-x: hidden;
      }

      .app-shell {
        min-height: 100vh;
        display: grid;
        grid-template-columns: 280px 1fr;
      }

      .sidebar {
        position: sticky;
        top: 0;
        height: 100vh;
        padding: 18px 16px;
        border-right: 1px solid var(--border);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.06) 0%,
          rgba(255, 255, 255, 0.03) 100%
        );
        backdrop-filter: blur(14px);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: 14px;
        background: rgba(255, 255, 255, 0.06);
        box-shadow: var(--shadow2);
      }

      .brand .logo {
        width: 38px;
        height: 38px;
        border-radius: 12px;
        background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
        box-shadow: 0 10px 22px rgba(124, 92, 255, 0.28);
        display: grid;
        place-items: center;
        color: #07101f;
        font-weight: 800;
        letter-spacing: -0.02em;
      }

      .brand .title {
        line-height: 1.1;
      }

      .brand .title .name {
        font-weight: 700;
        letter-spacing: -0.02em;
      }

      .brand .title .sub {
        font-size: 12px;
        color: var(--muted);
      }

      .side-nav {
        margin-top: 18px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .side-link {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        border-radius: 12px;
        color: var(--text);
        text-decoration: none;
        background: transparent;
        border: 1px solid transparent;
      }

      .side-link i {
        width: 18px;
        color: var(--muted);
      }

      .side-link:hover {
        border-color: rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.06);
      }

      .side-link.active {
        background: linear-gradient(
          135deg,
          rgba(124, 92, 255, 0.26) 0%,
          rgba(47, 208, 255, 0.12) 100%
        );
        border-color: rgba(124, 92, 255, 0.35);
        box-shadow: 0 14px 28px rgba(0, 0, 0, 0.35);
      }

      .side-link.active i {
        color: rgba(255, 255, 255, 0.85);
      }

      .sidebar-footer {
        position: absolute;
        bottom: 16px;
        left: 16px;
        right: 16px;
        border-top: 1px solid var(--border);
        padding-top: 12px;
        color: var(--muted);
        font-size: 12px;
      }

      .content {
        padding: 18px 18px 28px 18px;
      }

      .topbar {
        border: 1px solid var(--border);
        border-radius: 16px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(14px);
        box-shadow: var(--shadow2);
        padding: 12px 14px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .crumbs {
        color: var(--muted);
        font-size: 13px;
      }

      .crumbs b {
        color: var(--text);
      }

      .card-glass {
        border: 1px solid var(--border);
        border-radius: 18px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.08) 0%,
          rgba(255, 255, 255, 0.04) 100%
        );
        box-shadow: var(--shadow);
        backdrop-filter: blur(16px);
      }

      .form-control,
      .form-select {
        background-color: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.14);
        color: var(--text);
      }

      .form-control:focus,
      .form-select:focus {
        border-color: rgba(124, 92, 255, 0.55);
        box-shadow: 0 0 0 0.25rem rgba(124, 92, 255, 0.22);
      }

      .form-control::placeholder {
        color: rgba(255, 255, 255, 0.45);
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
        border: 0;
        box-shadow: 0 10px 22px rgba(124, 92, 255, 0.24);
      }

      .btn-primary:hover {
        filter: brightness(1.05);
      }

      .table {
        color: var(--text);
      }

      .table thead th {
        color: rgba(255, 255, 255, 0.78);
      }

      .table > :not(caption) > * > * {
        background-color: transparent;
        border-color: rgba(255, 255, 255, 0.10);
      }

      pre.log-box {
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(0, 0, 0, 0.35);
        color: rgba(255, 255, 255, 0.86);
        border-radius: 16px;
        padding: 14px;
        max-height: 70vh;
        overflow: auto;
        box-shadow: var(--shadow2);
      }

      .auth-wrap {
        min-height: 100vh;
        display: grid;
        place-items: center;
        padding: 24px;
      }

      .auth-card {
        width: 100%;
        max-width: 520px;
      }

      .auth-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 14px;
      }

      .auth-header .logo {
        width: 44px;
        height: 44px;
        border-radius: 14px;
        background: linear-gradient(135deg, var(--accent) 0%, var(--accent2) 100%);
        display: grid;
        place-items: center;
        color: #07101f;
        font-weight: 900;
      }

      .auth-header .name {
        font-weight: 800;
        letter-spacing: -0.02em;
      }

      .auth-header .sub {
        color: var(--muted);
        font-size: 13px;
      }
    </style>
  </head>

  <body>
    {% if show_nav is not defined %}{% set show_nav = true %}{% endif %}
    {% if show_nav %}
      {% set path = request.url.path %}
      <div class="app-shell">
        <aside class="sidebar">
          <div class="brand">
            <div class="logo">M</div>
            <div class="title">
              <div class="name">MAIL_API</div>
              <div class="sub">Control Panel</div>
            </div>
          </div>

          <div class="side-nav">
            <a
              class="side-link {% if path == '/' %}active{% endif %}"
              href="{{ prefix }}/"
            >
              <i class="fa-solid fa-grid-2"></i>
              Dashboard
            </a>
            <a
              class="side-link {% if path.startswith('/webhooks') %}active{% endif %}"
              href="{{ prefix }}/webhooks"
            >
              <i class="fa-solid fa-link"></i>
              Webhooks
            </a>
            <a
              class="side-link {% if path.startswith('/queue') %}active{% endif %}"
              href="{{ prefix }}/queue"
            >
              <i class="fa-solid fa-layer-group"></i>
              Queue
            </a>
            <a
              class="side-link {% if path.startswith('/settings') %}active{% endif %}"
              href="{{ prefix }}/settings"
            >
              <i class="fa-solid fa-sliders"></i>
              Settings
            </a>
            <a
              class="side-link {% if path.startswith('/smtp') %}active{% endif %}"
              href="{{ prefix }}/smtp"
            >
              <i class="fa-solid fa-paper-plane"></i>
              SMTP
            </a>
            <a
              class="side-link {% if path.startswith('/logs') %}active{% endif %}"
              href="{{ prefix }}/logs"
            >
              <i class="fa-solid fa-rectangle-list"></i>
              Logs
            </a>
            <a
              class="side-link {% if path.startswith('/ip-rules') %}active{% endif %}"
              href="{{ prefix }}/ip-rules"
            >
              <i class="fa-solid fa-shield-halved"></i>
              IP Rules
            </a>
            <a
              class="side-link {% if path.startswith('/admins') %}active{% endif %}"
              href="{{ prefix }}/admins"
            >
              <i class="fa-solid fa-users-gear"></i>
              Admins
            </a>
          </div>

          <div class="sidebar-footer">
            {% if user %}
              Logged in as <b>{{ user }}</b>
            {% else %}
              Not logged in
            {% endif %}
          </div>
        </aside>

        <div class="content">
          <div class="topbar">
            <div class="crumbs">
              <span>MAIL_API</span>
              <span class="mx-2">/</span>
              <b>{% block header_title %}Control Panel{% endblock %}</b>
            </div>

            {% if user %}
              <form method="post" action="{{ prefix }}/logout" class="m-0">
                <button type="submit" class="btn btn-sm btn-outline-light">
                  <i class="fa-solid fa-right-from-bracket me-1"></i>
                  Logout
                </button>
              </form>
            {% endif %}
          </div>

          <div class="mt-3">
            {% block content %}{% endblock %}
          </div>
        </div>
      </div>
    {% else %}
      <div class="auth-wrap">
        <div class="auth-card">
          <div class="auth-header">
            <div class="logo">M</div>
            <div>
              <div class="name">MAIL_API</div>
              <div class="sub">Control Panel</div>
            </div>
          </div>

          <div class="card-glass p-4">
            {% block auth_content %}{% endblock %}
          </div>
        </div>
      </div>
    {% endif %}

    <script>
      (function () {
        var meta = document.querySelector('meta[name="csrf-token"]');
        var token = meta ? (meta.getAttribute('content') || '') : '';
        if (!token) {
          return;
        }
        var forms = document.querySelectorAll('form[method="post"]');
        for (var i = 0; i < forms.length; i++) {
          var f = forms[i];
          if (f.querySelector('input[name="csrf_token"]')) {
            continue;
          }
          var input = document.createElement('input');
          input.type = 'hidden';
          input.name = 'csrf_token';
          input.value = token;
          f.appendChild(input);
        }
      })();
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>

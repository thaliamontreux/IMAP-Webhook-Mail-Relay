{% extends "base.html" %}

{% block page_title %}MAIL_API - SMTP{% endblock %}
{% block header_title %}SMTP{% endblock %}

{% block content %}
  <div class="card-glass p-4">
    <div class="d-flex align-items-start justify-content-between flex-wrap gap-3">
      <div>
        <h2 class="h5 mb-1">SMTP relay configuration</h2>
        <div style="color: var(--muted);">
          Choose a common port/security preset, then save and test.
        </div>
      </div>
    </div>

    <ul class="nav nav-pills mt-3" role="tablist">
      <li class="nav-item" role="presentation">
        <a
          class="nav-link {% if preset_port == 25 %}active{% endif %}"
          href="{{ prefix }}/smtp/25"
        >
          <i class="fa-solid fa-plug me-1"></i>
          25
        </a>
      </li>
      <li class="nav-item" role="presentation">
        <a
          class="nav-link {% if preset_port == 465 %}active{% endif %}"
          href="{{ prefix }}/smtp/465"
        >
          <i class="fa-solid fa-lock me-1"></i>
          465
        </a>
      </li>
      <li class="nav-item" role="presentation">
        <a
          class="nav-link {% if preset_port == 587 %}active{% endif %}"
          href="{{ prefix }}/smtp/587"
        >
          <i class="fa-solid fa-shield me-1"></i>
          587
        </a>
      </li>
    </ul>

    <div class="mt-3">
      <h3 class="h6" style="color: var(--muted);">Preset</h3>
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
        <div>
          <div class="h5 mb-0">{{ preset_label }}</div>
        </div>
      </div>
    </div>

    {% if test_result %}
      <div class="alert alert-info mt-3 mb-0" role="alert">
        {{ test_result }}
      </div>
    {% endif %}
  </div>

  <div class="row g-3 mt-0">
    <div class="col-12 col-xl-7">
      <div class="card-glass p-4 mt-3">
        <h2 class="h5 mb-3">Connection settings</h2>

        <form method="post" action="{{ prefix }}/smtp/{{ preset_port }}">
          <div class="mb-3">
            <label class="form-label">SMTP Host</label>
            <input
              class="form-control"
              name="smtp_host"
              value="{{ values['smtp_host'] }}"
              placeholder="smtp.example.com"
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Sender Name (optional)</label>
            <input
              class="form-control"
              name="smtp_sender_name"
              value="{{ values['smtp_sender_name'] }}"
              placeholder="Example App"
            />
          </div>

          <div class="mb-3">
            <label class="form-label">SMTP Username (optional)</label>
            <input
              class="form-control"
              name="smtp_username"
              value="{{ values['smtp_username'] }}"
              placeholder="user@example.com"
            />
          </div>

          <div class="mb-3">
            <label class="form-label">SMTP Password (leave blank to keep existing)</label>
            <input
              class="form-control"
              name="smtp_password"
              type="password"
              value=""
              placeholder="••••••••••••"
            />
          </div>

          <div class="row g-3">
            <div class="col-12 col-lg-6">
              <label class="form-label">Timeout Seconds</label>
              <input
                class="form-control"
                name="smtp_timeout_seconds"
                value="{{ values['smtp_timeout_seconds'] }}"
              />
            </div>
            <div class="col-12 col-lg-6 d-flex align-items-end">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  name="smtp_ignore_certificates"
                  value="1"
                  id="smtp_ignore_certificates"
                  {% if values['smtp_ignore_certificates'] in ['1','true','on','yes'] %}checked{% endif %}
                />
                <label class="form-check-label" for="smtp_ignore_certificates">
                  Ignore certificates (TLS verification off)
                </label>
              </div>
            </div>
          </div>

          <div class="d-grid mt-3">
            <button type="submit" class="btn btn-primary">
              <i class="fa-solid fa-floppy-disk me-2"></i>
              Save
            </button>
          </div>
        </form>
      </div>
    </div>

    <div class="col-12 col-xl-5">
      <div class="card-glass p-4 mt-3">
        <h2 class="h5 mb-2">Test SMTP</h2>
        <p class="mb-3" style="color: var(--muted);">
          Save settings first, then send a test email to confirm connectivity.
        </p>

        <form method="post" action="{{ prefix }}/smtp/{{ preset_port }}/test">
          <div class="mb-3">
            <label class="form-label">Test Recipient Email</label>
            <input
              class="form-control"
              name="test_to"
              placeholder="you@example.com"
            />
          </div>

          <div class="d-grid">
            <button type="submit" class="btn btn-outline-light">
              <i class="fa-solid fa-paper-plane me-2"></i>
              Send Test Email
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
{% endblock %}
